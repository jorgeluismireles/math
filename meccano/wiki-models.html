<!DOCTYPE html>
<html>
<head>
<title>Wiki models</title>
<style>
svg { border:1px solid gray; }
</style>
<script src="svg.js"></script>
<script src="meccano.js"></script>
</head>
<body>
<table>
<tr><td>Width</td><td><input type="number" value="400" id="width"></td></tr>
<tr><td>Height</td><td><input type="number" value="400" id="height"></td></tr>	
<tr><td><button id="octagon">Octagon</button></td>
</table>
<div id="svg">
</div>
</body>
<script>
const $elem  = (id)=> document.getElementById(id)
const $value = (id)=> $elem(id).value

document.getElementById("octagon").onclick = ()=> {
	const svg = {
		width:  parseInt($value("width")),
		height: parseInt($value("height"))
	}
	const Svg = new SVG()
	const s = Svg.svg(svg.width, svg.width)
	const xml = $elem("svg").appendChild(s)

	const tx = svg.width/2
	const ty = svg.height/2
	const scale = 4
	const strokeWidth = 0.3
	const g0 = Svg.g({ 
		transform:`translate(${tx} ${ty}) scale(${scale} -${scale}) rotate(22.5)`,
		"stroke-width":`${strokeWidth}px`,
		"stroke-linecap": "round",
		"stroke":"#00f",
	})
	s.appendChild(g0)

	const g4 = Svg.g({ "fill":"#08f" })
	const g5 = Svg.g({ "fill":"#0f4" })
	const g6 = Svg.g({ "fill":"#f20" })
	g0.appendChild(g4)
	g0.appendChild(g5)
	g0.appendChild(g6)

	const p = {
		opacity: 0.5
	}

	const svgRod = (R, n, t)=> {
		return Svg.path(rod(R, n), t, { opacity: 0.5 })
	}

	const S = 8
	const C = S*Math.sqrt(4 + 2*Math.sqrt(2))/2 // circumradius
	const r4 = []
	const r5 = []
	const r6 = []
	const acos4_5 = 180*Math.acos(4/5)/Math.PI
	const asin2_6 = 180*Math.asin(2/6)/Math.PI
	const push4 = (t)=> { r4.push(svgRod(S, 4, t)) }
	const push5 = (t)=> { r5.push(svgRod(S, 5, t)) }
	const push6 = (t)=> { r6.push(svgRod(S, 6, t)) }
	for (let i=0; i < 8; i++) {
		const rt1 = `rotate(${-45*i}) translate(0 ${4*C})`
		const r2 = -90-22.5
		push4(`${rt1} rotate(${r2})`)
		if (i==0) { // north
			push4(`${rt1} rotate(${r2 - 90})`)
			push5(`${rt1} rotate(${r2 - acos4_5})`)
		}
		if (i==1) { // north-east
			push4(`${rt1} rotate(${r2 - 45})`)
		}
		if (i==3) {
			const t3a = `${rt1} rotate(${r2 - 90})`
			const t3b = `translate(0 ${4*S}) rotate(${180 - acos4_5})`
			const t3c = `translate(0 ${4*S}) rotate(${180 - 45 - asin2_6})`
			push4(`${t3a}`)
			push5(`${t3a} ${t3b}`)
			push6(`${t3a} ${t3c}`)
		}
		if (i==6) {
			const t6a = `${rt1} rotate(${r2 - 45})`
			const t6b = `translate(0 ${4*S}) rotate(${180 + acos4_5})`
			const t6c = `translate(0 ${4*S}) rotate(${180 + 45 + asin2_6})`
			push4(`${t6a}`)
			push5(`${t6a} ${t6b}`)
			push6(`${t6a} ${t6c}`)
		}
	}
	r4.forEach(r => { g4.appendChild(r) })
	r5.forEach(r => { g5.appendChild(r) })
	r6.forEach(r => { g6.appendChild(r) })

	let a = document.createElement("a")
	let filename = "meccano_octagon.svg"
	a.download = a.textContent = "meccano_octagon.svg"
	const app = `data:application/xml,<?xml version="1.0" encoding="UTF-8"?>`
	a.href = `${app}${encodeURIComponent(s.outerHTML)}`
	document.body.append(a)
}
</script>

</html>